{% extends "base.html" %}
{% block title %}{{ _('Blocks') }} | Fresado Pro{% endblock %}
{% block instructions %}
<div class="alert alert-success d-flex align-items-center" role="alert">
  <i class="bi bi-box me-2"></i>
  {{ _('Manage block inventory, consult materials, shades, and brands. Use filters to find what you need.') }}
</div>
{% endblock %}
{% block content %}
<div class="row g-4">
  <div class="col-12 mb-4">
    <div class="card border-0 shadow-sm animate__animated animate__fadeInUp">
      <div class="card-body">
        <h4 class="mb-3"><i class="bi bi-plus-circle"></i> {{ _('Add New Block to Inventory') }}</h4>
        <form method="post" class="row g-3 mb-0" id="form-bloque-agregar">
          <div class="col-md-3">
            <label class="form-label">{{ _('Material') }}</label>
            <select class="form-select" name="material" id="material" size="6" required style="height:auto;min-height:120px;">
              <option value="">-- {{ _('Select') }} --</option>
              {% for mat in materiales %}
                <option value="{{ mat }}" {% if request.form.get('material', '') == mat %}selected{% endif %}>{{ mat }}</option>
              {% endfor %}
            </select>
          </div>
          <div class="col-md-3">
            <label class="form-label">{{ _('Shade') }}</label>
            <select class="form-select" name="shade" id="shade" size="6" required style="height:auto;min-height:120px;">
              <option value="">-- {{ _('Select') }} --</option>
              {% for s in shades %}
                <option value="{{ s }}" {% if request.form.get('shade', '') == s %}selected{% endif %}>{{ s }}</option>
              {% endfor %}
            </select>
          </div>
          <div class="col-md-3">
            <label class="form-label">{{ _('Brand') }}</label>
            <select class="form-select" name="marca" id="marca" size="6" style="height:auto;min-height:120px;">
              <option value="">-- {{ _('Select') }} --</option>
              {% for m in marcas %}
                <option value="{{ m }}" {% if request.form.get('marca', '') == m %}selected{% endif %}>{{ m }}</option>
              {% endfor %}
            </select>
          </div>
          <div class="col-md-2">
            <label class="form-label">{{ _('Thickness') }}</label>
            <select class="form-select" name="grosor" id="grosor" size="6" required style="height:auto;min-height:120px;">
              <option value="">-- {{ _('Select') }} --</option>
              {% for g in grosores %}
                <option value="{{ g }}" {% if request.form.get('grosor', '') == g %}selected{% endif %}>{{ g }}</option>
              {% endfor %}
            </select>
          </div>
          <div class="col-md-1">
            <label class="form-label">{{ _('Count') }}</label>
            <input type="number" name="cantidad" class="form-control" min="1" value="{{ request.form.get('cantidad', '1') }}" required>
          </div>
          <div class="col-12 text-end">
            <button type="submit" class="btn btn-success"><i class="bi bi-plus-circle"></i> {{ _('Add') }}</button>
          </div>
        </form>
      </div>
    </div>
  </div>
  <div class="col-lg-6">
    <div class="card border-0 shadow-sm animate__animated animate__fadeInUp mb-4">
      <div class="card-body">
        <h4 class="mb-3"><i class="bi bi-box"></i> {{ _('Used Blocks') }}</h4>
        <div class="table-responsive animate__animated animate__fadeIn">
          <table class="table table-striped table-hover table-bloques" id="tabla-bloques-usados">
            <thead class="table-secondary">
              <tr>
                <th><i class="bi bi-upc-scan"></i> {{ _('Block Code') }}</th>
                <th><i class="bi bi-box"></i> {{ _('Material') }}</th>
                <th><i class="bi bi-palette"></i> {{ _('Shade') }}</th>
                <th><i class="bi bi-award"></i> {{ _('Brand') }}</th>
                <th><i class="bi bi-rulers"></i> {{ _('Thickness') }}</th>
                <th><i class="bi bi-123"></i> {{ _('Model Count') }}</th>
                <th><i class="bi bi-calendar"></i> {{ _('Creation Date') }}</th>
                <th><i class="bi bi-gear"></i> {{ _('Actions') }}</th>
              </tr>
            </thead>
            <tbody>
              {% for bloque in bloques_usados %}
              <tr>
                <td>{{ bloque.codigo_barra }}</td>
                <td>{{ bloque.material }}</td>
                <td>{{ bloque.shade }}</td>
                <td>{{ bloque.marca }}</td>
                <td>{{ bloque.grosor }}</td>
                <td>{{ bloque.modelos_fresados }}</td>
                <td>{% if bloque.fecha_creacion %}{{ bloque.fecha_creacion.strftime('%Y-%m-%d') }}{% endif %}</td>
                <td>
                  <form method="post" action="{{ url_for('bloques.eliminar_bloque', bloque_id=bloque.id) }}" style="display:inline;">
                    <button type="submit" class="btn btn-outline-danger btn-sm"><i class="bi bi-trash"></i></button>
                  </form>
                  <a href="{{ url_for('bloques.editar_bloque', bloque_id=bloque.id) }}" class="btn btn-outline-warning btn-sm"><i class="bi bi-pencil"></i></a>
                </td>
              </tr>
              {% endfor %}
            </tbody>
          </table>
        </div>
      </div>
    </div>
  </div>
  <div class="col-lg-6">
    <div class="card border-0 shadow-sm animate__animated animate__fadeInUp mb-4">
      <div class="card-body">
        <h4 class="mb-3"><i class="bi bi-box"></i> {{ _('New Blocks') }}</h4>
        <div class="table-responsive animate__animated animate__fadeIn">
          <table class="table table-striped table-hover table-bloques" id="tabla-bloques-nuevos">
            <thead class="table-secondary">
              <tr>
                <th><i class="bi bi-box"></i> {{ _('Material') }}</th>
                <th><i class="bi bi-palette"></i> {{ _('Shade') }}</th>
                <th><i class="bi bi-award"></i> {{ _('Brand') }}</th>
                <th><i class="bi bi-rulers"></i> {{ _('Thickness') }}</th>
                <th><i class="bi bi-123"></i> {{ _('Count') }}</th>
                <th><i class="bi bi-calendar"></i> {{ _('Creation Date') }}</th>
                <th><i class="bi bi-gear"></i> {{ _('Actions') }}</th>
              </tr>
            </thead>
            <tbody>
              {% for bloque in bloques_nuevos %}
              <tr>
                <td>{{ bloque.material }}</td>
                <td>{{ bloque.shade }}</td>
                <td>{{ bloque.marca }}</td>
                <td>{{ bloque.grosor }}</td>
                <td>{{ bloque.cantidad }}</td>
                <td>{% if bloque.fecha_creacion %}{{ bloque.fecha_creacion.strftime('%Y-%m-%d') }}{% endif %}</td>
                <td>
                  <form method="post" action="{{ url_for('bloques.eliminar_bloque', bloque_id=bloque.id) }}" style="display:inline;">
                    <button type="submit" class="btn btn-outline-danger btn-sm"><i class="bi bi-trash"></i></button>
                  </form>
                  <a href="{{ url_for('bloques.editar_bloque', bloque_id=bloque.id) }}" class="btn btn-outline-warning btn-sm"><i class="bi bi-pencil"></i></a>
                </td>
              </tr>
              {% endfor %}
            </tbody>
          </table>
        </div>
      </div>
    </div>
  </div>
</div>
<style>
select.form-select:focus option:checked, select.form-select option:checked {
  background: #1976d2 !important;
  color: #fff !important;
}
select#shade:focus option:checked, select#shade option:checked {
  background: #8e24aa !important;
  color: #fff !important;
}
select#marca:focus option:checked, select#marca option:checked {
  background: #43a047 !important;
  color: #fff !important;
}
select#grosor:focus option:checked, select#grosor option:checked {
  background: #fbc02d !important;
  color: #222 !important;
}
.table-bloques, .table-bloques td, .table-bloques th {
  font-size: 0.93em !important;
}
</style>
{% endblock %}
{% block scripts %}
{{ super() }}
<script>
$(document).ready(function(){
  // Para bloques nuevos: columna 4 (cantidad)
  $('#tabla-bloques-nuevos').DataTable({
    language: { url: window.getDataTablesLangUrl() },
    "order": [[4, "desc"]],
    "dom": '<"datatable-top"f>t<"datatable-bottom d-flex justify-content-between align-items-center"lip>'
  });
  // Para bloques usados: columna 5 (modelos fresados)
  $('#tabla-bloques-usados').DataTable({
    language: { url: window.getDataTablesLangUrl() },
    "order": [[5, "desc"]],
    "dom": '<"datatable-top"f>t<"datatable-bottom d-flex justify-content-between align-items-center"lip>'
  });
});
</script>
{% endblock %}